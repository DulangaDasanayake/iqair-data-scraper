<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AQ Data File Downloader</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        h1 {
            color: #333;
        }
        .file-list {
            list-style-type: none;
            padding: 0;
        }
        .file-list li {
            margin: 10px 0;
        }
        .btn {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 20px;
        }
        .btn:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <h1>Download AQI Files</h1>
    <h2>Maps</h2>
    <ul id="map-files" class="file-list"></ul>
    <h2>Charts</h2>
    <ul id="chart-files" class="file-list"></ul>
    <button class="btn" id="download-btn">Download Selected Files</button>

    <script>
        const mapFilesList = document.getElementById('map-files');
        const chartFilesList = document.getElementById('chart-files');
        const downloadBtn = document.getElementById('download-btn');

        // GitHub API URL for your repo files
        const repoOwner = 'DulangaDasanayake'; // Replace with your GitHub username
        const repoName = 'iqair-data-scraper'; // Replace with your repo name
        const branchName = 'main'; // Or the branch where the files are stored

        // Get files from the GitHub repo (Maps & Charts folders)
        async function fetchFiles(folderPath) {
            const url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folderPath}?ref=${branchName}`;
            const response = await fetch(url);
            const data = await response.json();
            return data;
        }

        // Populate the file list
        async function populateFileList() {
            try {
                const mapFiles = await fetchFiles('maps');
                const chartFiles = await fetchFiles('charts');

                // Populate maps list
                mapFiles.forEach(file => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `
                        <input type="checkbox" value="${file.download_url}" id="map-${file.name}">
                        <label for="map-${file.name}">${file.name}</label>
                    `;
                    mapFilesList.appendChild(listItem);
                });

                // Populate charts list
                chartFiles.forEach(file => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `
                        <input type="checkbox" value="${file.download_url}" id="chart-${file.name}">
                        <label for="chart-${file.name}">${file.name}</label>
                    `;
                    chartFilesList.appendChild(listItem);
                });
            } catch (error) {
                console.error('Error fetching files:', error);
            }
        }

        // Handle file download when the button is clicked
        downloadBtn.addEventListener('click', () => {
            const selectedFiles = [];
            
            // Collect selected files (checked checkboxes)
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            checkboxes.forEach(checkbox => {
                selectedFiles.push(checkbox.value);
            });

            // If no files are selected
            if (selectedFiles.length === 0) {
                alert('Please select at least one file to download.');
                return;
            }

            // Download selected files
            selectedFiles.forEach(fileUrl => {
                const link = document.createElement('a');
                link.href = fileUrl;
                link.download = fileUrl.split('/').pop(); // Set file name to be downloaded
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });
        });

        // Initialize file list on page load
        window.onload = populateFileList;
    </script>
</body>
</html>
